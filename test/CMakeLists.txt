add_library( gtest ${CMAKE_CURRENT_LIST_DIR}/../thirdparty/googletest-mpi/gtest/gtest-all.cc )
target_include_directories( gtest PUBLIC ${CMAKE_CURRENT_LIST_DIR}/../thirdparty/googletest-mpi ${CMAKE_CURRENT_LIST_DIR}/.. )

function( add_t8_test TEST_NAME TEST_SOURCES )
    add_executable( ${TEST_NAME} ${TEST_SOURCES} )
    target_link_libraries( ${TEST_NAME} PRIVATE T8 gtest )
    if( T8CODE_ENABLE_MPI )
        target_compile_definitions( ${TEST_NAME} PRIVATE T8_ENABLE_MPI )
        target_compile_definitions( ${TEST_NAME} PRIVATE T8_ENABLE_MPIIO )
    endif()
    add_test( NAME ${TEST_NAME} COMMAND ./${TEST_NAME} )
endfunction()

add_t8_test( t8_gtest_cmesh_bcast t8_gtest_main.cxx t8_cmesh/t8_gtest_bcast.cxx )
add_t8_test( t8_gtest_eclass t8_gtest_main.cxx t8_gtest_eclass.cxx )
add_t8_test( t8_gtest_vec t8_gtest_main.cxx t8_gtest_vec.cxx )
add_t8_test( t8_gtest_mat t8_gtest_main.cxx t8_gtest_mat.cxx )
add_t8_test( t8_gtest_refcount t8_gtest_main.cxx t8_gtest_refcount.cxx )
add_t8_test( t8_gtest_occ_linkage t8_gtest_main.cxx t8_gtest_occ_linkage.cxx )
add_t8_test( t8_gtest_version t8_gtest_main.cxx t8_gtest_version.cxx )
add_t8_test( t8_gtest_basics t8_gtest_main.cxx t8_gtest_basics.cxx )
add_t8_test( t8_gtest_netcdf_linkage t8_gtest_main.cxx t8_gtest_netcdf_linkage.cxx )
add_t8_test( t8_gtest_vtk_linkage t8_gtest_main.cxx t8_gtest_vtk_linkage.cxx )

add_t8_test( t8_gtest_hypercube t8_gtest_main.cxx t8_cmesh/t8_gtest_hypercube.cxx )
add_t8_test( t8_gtest_cmesh_copy t8_gtest_main.cxx t8_cmesh/t8_gtest_cmesh_copy.cxx )
add_t8_test( t8_gtest_cmesh_face_is_boundary t8_gtest_main.cxx t8_cmesh/t8_gtest_cmesh_face_is_boundary.cxx )
add_t8_test( t8_gtest_cmesh_partition t8_gtest_main.cxx t8_cmesh/t8_gtest_cmesh_partition.cxx )
add_t8_test( t8_gtest_cmesh_set_partition_offsets t8_gtest_main.cxx t8_cmesh/t8_gtest_cmesh_set_partition_offsets.cxx )
add_t8_test( t8_gtest_cmesh_set_join_by_vertices t8_gtest_main.cxx t8_cmesh/t8_gtest_cmesh_set_join_by_vertices.cxx )
add_t8_test( t8_gtest_multiple_attributes t8_gtest_main.cxx t8_cmesh/t8_gtest_multiple_attributes.cxx )
add_t8_test( t8_gtest_attribute_gloidx_array t8_gtest_main.cxx t8_cmesh/t8_gtest_attribute_gloidx_array.cxx )

add_t8_test( t8_gtest_shmem t8_gtest_main.cxx t8_data/t8_gtest_shmem.cxx )

add_t8_test( t8_gtest_element_volume t8_gtest_main.cxx t8_forest/t8_gtest_element_volume.cxx )
add_t8_test( t8_gtest_search t8_gtest_main.cxx t8_forest/t8_gtest_search.cxx )
add_t8_test( t8_gtest_element_general_function t8_gtest_main.cxx t8_forest/t8_gtest_element_general_function.cxx )
add_t8_test( t8_gtest_half_neighbors t8_gtest_main.cxx t8_forest/t8_gtest_half_neighbors.cxx )
add_t8_test( t8_gtest_find_owner t8_gtest_main.cxx t8_forest/t8_gtest_find_owner.cxx )
add_t8_test( t8_gtest_user_data t8_gtest_main.cxx t8_forest/t8_gtest_user_data.cxx )
add_t8_test( t8_gtest_transform t8_gtest_main.cxx t8_forest/t8_gtest_transform.cxx )
add_t8_test( t8_gtest_ghost_exchange t8_gtest_main.cxx t8_forest/t8_gtest_ghost_exchange.cxx )
add_t8_test( t8_gtest_ghost_delete t8_gtest_main.cxx t8_forest/t8_gtest_ghost_delete.cxx )
add_t8_test( t8_gtest_ghost_and_owner t8_gtest_main.cxx t8_forest/t8_gtest_ghost_and_owner.cxx )

add_t8_test( t8_gtest_permute_hole t8_gtest_main.cxx t8_forest_incomplete/t8_gtest_permute_hole.cxx )
add_t8_test( t8_gtest_recursive t8_gtest_main.cxx t8_forest_incomplete/t8_gtest_recursive.cxx )
add_t8_test( t8_gtest_iterate_replace t8_gtest_main.cxx t8_forest_incomplete/t8_gtest_iterate_replace.cxx )
add_t8_test( t8_gtest_empty_local_tree t8_gtest_main.cxx t8_forest_incomplete/t8_gtest_empty_local_tree.cxx )
add_t8_test( t8_gtest_empty_global_tree t8_gtest_main.cxx t8_forest_incomplete/t8_gtest_empty_global_tree.cxx )

add_t8_test( t8_gtest_geometry_occ t8_gtest_main.cxx t8_geometry/t8_geometry_implementations/t8_gtest_geometry_occ.cxx )
add_t8_test( t8_gtest_geometry t8_gtest_main.cxx t8_geometry/t8_gtest_geometry.cxx )
add_t8_test( t8_gtest_point_inside t8_gtest_main.cxx t8_geometry/t8_gtest_point_inside.cxx )

add_t8_test( t8_gtest_vtk_reader t8_gtest_main.cxx t8_IO/t8_gtest_vtk_reader.cxx )

add_t8_test( t8_gtest_nca t8_gtest_main.cxx t8_schemes/t8_gtest_nca.cxx )
add_t8_test( t8_gtest_pyra_connectivity t8_gtest_main.cxx t8_schemes/t8_gtest_pyra_connectivity.cxx )
add_t8_test( t8_gtest_face_neigh t8_gtest_main.cxx t8_schemes/t8_gtest_face_neigh.cxx )
add_t8_test( t8_gtest_init_linear_id t8_gtest_main.cxx t8_schemes/t8_gtest_init_linear_id.cxx )
add_t8_test( t8_gtest_ancestor t8_gtest_main.cxx t8_schemes/t8_gtest_ancestor.cxx )
add_t8_test( t8_gtest_element_count_leafs t8_gtest_main.cxx t8_schemes/t8_gtest_element_count_leafs.cxx )
add_t8_test( t8_gtest_element_ref_coords t8_gtest_main.cxx t8_schemes/t8_gtest_element_ref_coords.cxx )
add_t8_test( t8_gtest_descendant t8_gtest_main.cxx t8_schemes/t8_gtest_descendant.cxx )
add_t8_test( t8_gtest_find_parent t8_gtest_main.cxx t8_schemes/t8_gtest_find_parent.cxx )
add_t8_test( t8_gtest_equal t8_gtest_main.cxx t8_schemes/t8_gtest_equal.cxx )
add_t8_test( t8_gtest_successor t8_gtest_main.cxx t8_schemes/t8_gtest_successor.cxx )
add_t8_test( t8_gtest_boundary_extrude t8_gtest_main.cxx t8_schemes/t8_gtest_boundary_extrude.cxx )
add_t8_test( t8_gtest_face_descendant t8_gtest_main.cxx t8_schemes/t8_gtest_face_descendant.cxx )
add_t8_test( t8_gtest_default t8_gtest_main.cxx t8_schemes/t8_gtest_default.cxx )
add_t8_test( t8_gtest_child_parent_face t8_gtest_main.cxx t8_schemes/t8_gtest_child_parent_face.cxx )